# دليل نشر وتشغيل نظام إدارة التسكين

أهلاً بك! هذا الدليل سيساعدك خطوة بخطوة على نشر وتشغيل نظام إدارة التسكين على منصة **Railway.app** وربطه بالدومين الخاص بك.

## محتويات المشروع

لقد تم تجهيز المشروع بالكامل ليعمل بشكل مستقل خارج بيئة Manus. أهم التعديلات تشمل:

- **نظام مصادقة مستقل:** تم استبدال نظام Manus OAuth بنظام تسجيل دخول يعتمد على اسم المستخدم وكلمة المرور مع استخدام JWT (JSON Web Tokens) لتأمين الجلسات.
- **دعم OpenAI:** تم تعديل خاصية قراءة بطاقات الهوية (OCR) والرؤى الذكية لتعمل مباشرة من خلال واجهة برمجة تطبيقات OpenAI.
- **تخزين الملفات:** يمكن للنظام الآن حفظ الصور المرفوعة (مثل صور بطاقات الهوية) على مساحة تخزين S3-compatible أو محلياً على نفس السيرفر.
- **جاهز للنشر:** تم تضمين ملف `Dockerfile` و `railway.json` لتسهيل عملية النشر التلقائي على Railway.

---

## متطلبات أساسية

قبل البدء، تأكد من أن لديك:

1.  **حساب على Railway.app:** يمكنك التسجيل مجاناً من [هنا](https://railway.app).
2.  **حساب على GitHub:** لنشر الكود بسهولة.
3.  **مفتاح OpenAI API Key:** مطلوب لتشغيل خاصية قراءة بطاقات الهوية (OCR) والرؤى الذكية. يمكنك الحصول عليه من [منصة OpenAI](https://platform.openai.com/api-keys).
4.  **الدومين الخاص بك:** الذي اشتريته من أي شركة تسجيل نطاقات.

---

## خطوات النشر

### الخطوة 1: رفع المشروع على GitHub

1.  قم بإنشاء مستودع جديد (New Repository) على حسابك في GitHub (اجعله خاصاً - Private - للحفاظ على الكود).
2.  قم بفك ضغط ملف المشروع الذي استلمته (`housing-deploy.zip`).
3.  اتبع [تعليمات GitHub](https://docs.github.com/en/get-started/importing-your-projects-to-github/importing-source-code-to-github/adding-locally-hosted-code-to-github) لرفع ملفات المشروع إلى المستودع الجديد.

### الخطوة 2: إعداد المشروع على Railway

1.  اذهب إلى لوحة تحكم Railway واضغط **New Project**.
2.  اختر **Deploy from GitHub repo** واربط حسابك في GitHub، ثم اختر المستودع الذي أنشأته في الخطوة السابقة.
3.  بمجرد اختيار المستودع، سيقوم Railway تلقائياً بقراءة ملف `railway.json` والبدء في عملية النشر. لا تقلق إذا فشلت عملية النشر الأولى، سنقوم بإعداد قاعدة البيانات والمتغيرات الآن.
4.  في لوحة تحكم مشروعك على Railway، اضغط **Add a Service** واختر **Database** > **MySQL**.

### الخطوة 3: إعداد متغيرات البيئة (Environment Variables)

الآن لديك خدمتان في مشروعك: خدمة التطبيق (من GitHub) وخدمة قاعدة البيانات (MySQL).

1.  اذهب إلى خدمة التطبيق (WebApp) ثم إلى تبويب **Variables**.
2.  ستجد أن Railway قد أضافت متغير `DATABASE_URL` تلقائياً. هذا ممتاز!
3.  اضغط على **Raw Editor** وأضف المتغيرات التالية. **تأكد من تغيير القيم التي بين علامات `[...]` بقيم حقيقية وآمنة!**

```env
# الرابط الذي أضافه Railway تلقائياً، لا تغيره
# DATABASE_URL=mysql://...

# مفتاح سري لتأمين جلسات المستخدمين - اختر أي عبارة معقدة وطويلة
JWT_SECRET=[your-super-secret-jwt-key-change-this]

# بيانات الدخول للمدير الرئيسي للنظام
ADMIN_USERNAME=admin
ADMIN_PASSWORD=[your-secure-admin-password]
OWNER_OPEN_ID=admin-owner

# مفتاح OpenAI الخاص بك
OPENAI_API_KEY=[sk-your-openai-api-key]

# (اختياري) إعدادات تخزين S3 إذا كنت تريد استخدامه
# S3_ENDPOINT=https://your-s3-endpoint.com
# S3_ACCESS_KEY=your-access-key
# S3_SECRET_KEY=your-secret-key
# S3_BUCKET=housing-uploads
# S3_REGION=auto
```

4.  بعد إضافة المتغيرات، سيقوم Railway بإعادة نشر التطبيق تلقائياً. انتظر حتى تكتمل العملية.

### الخطوة 4: تجهيز قاعدة البيانات

1.  اذهب إلى خدمة **MySQL** في مشروعك على Railway.
2.  اذهب إلى تبويب **Data**.
3.  انسخ محتويات الملف `scripts/init-db.sql` (الموجود ضمن ملفات المشروع) والصقها في نافذة الاستعلام (Query) ثم اضغط **Run**.
4.  سيقوم هذا الأمر بإنشاء جميع الجداول اللازمة في قاعدة البيانات.

### الخطوة 5: ربط الدومين الخاص بك

1.  اذهب إلى خدمة التطبيق (WebApp) ثم إلى تبويب **Settings**.
2.  تحت قسم **Domains**، اضغط **Add Domain** وأدخل اسم الدومين الخاص بك (مثلاً `app.yourdomain.com`).
3.  سيقوم Railway بإعطائك قيمة **CNAME**. انسخ هذه القيمة.
4.  اذهب إلى لوحة تحكم الدومين لدى الشركة التي اشتريته منها، واذهب إلى إعدادات DNS.
5.  أضف سجل `CNAME` جديد، وضع القيمة التي نسختها من Railway.
6.  قد يستغرق الأمر من بضع دقائق إلى بضع ساعات حتى يتم تفعيل إعدادات الـ DNS عالمياً.

---

## تسجيل الدخول لأول مرة

بمجرد أن يصبح الدومين فعالاً، يمكنك الدخول إلى تطبيقك.

- **اسم المستخدم:** `admin` (أو القيمة التي وضعتها في `ADMIN_USERNAME`).
- **كلمة المرور:** كلمة المرور التي وضعتها في `ADMIN_PASSWORD`.

**مبروك!** الآن تطبيقك يعمل بشكل كامل ومستقل على استضافة Railway مع الدومين الخاص بك.
